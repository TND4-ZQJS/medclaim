<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Medical & Accident Claim - Claimant's Statement</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#f6f7f9; --card:#fff; --accent:#007aff; --muted:#666; --line:#e9e9ee;
  }
  *{box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;margin:18px;background:var(--bg);color:#111}
  main{max-width:980px;margin:0 auto;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 28px rgba(0,0,0,0.06)}
  h1{margin:15px 0 35px 0;font-size:1.50rem}
  .section{background:#fbfbfd;border:1px solid #eee;padding:14px;border-radius:10px;margin:12px 0}
  .section h2{margin:0 0 10px 0;font-size:1.05rem}
  label{display:block;margin:8px 0;font-size:0.95rem}
  .info-label {font-weight: bold;}
  input[type=text],input[type=number],select,textarea{
    width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-top:6px;font-size:1rem;background:#fff
  }
  h3{margin:20px 0 5px 0;font-size:1.00rem}
  textarea{resize:vertical;min-height:120px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:8px 0}
  .muted{color:var(--muted);font-size:0.85rem}
  button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer}
  button.secondary{background:#999}
  button.ghost{background:transparent;border:1px solid var(--line);color:#333}
  .actions{display:flex;gap:12px;align-items:center}

  .grid-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
@media (max-width: 600px) {
  .grid-2 {
    grid-template-columns: 1fr;
  }
}

 .grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}
@media (max-width: 600px) {
  .grid-3 {
    grid-template-columns: 1fr;
  }
}

 .grid-4 {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}
@media (max-width: 600px) {
  .grid-3 {
    grid-template-columns: 1fr;
  }
}

  #scrollTopBtn {
  position: fixed;
  bottom: 24px;
  right: 20px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: #007aff; /* iOS blue */
  color: #fff;
  cursor: pointer;
  display: none; /* hidden by default */
  box-shadow: 0 4px 8px rgba(0,0,0,0.25);
  align-items: center;
  justify-content: center;
  transition: opacity 0.3s ease;
  z-index: 999;
}

#scrollTopBtn svg {
  pointer-events: none; /* icon doesn't block click */
}

#scrollTopBtn.show {
  display: flex; /* show with flex centering */
  opacity: 1;
}


/* ---------- FIX DATE GROUP LAYOUT ---------- */
.row.date-group {
  justify-content: flex-start !important; /* Force left alignment */
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
}

/* Label should not stretch */
.date-group .date-label {
  flex: 0 0 auto;
  margin: 0;
  margin-right: 6px;
  font-weight: 500;
  color: #333;
  text-align: left;
  white-space: nowrap;
}

/* Container for inputs: left-aligned */
.date-group .date-inputs {
  display: flex;
  flex-grow: 0;
  justify-content: flex-start;
  gap: 6px;
}

/* Compact input fields */
.date-group .date-inputs input {
  width: 3.8em;
  text-align: center;
  padding: 9px 0; /* match global input height */
  border: 1px solid #ddd;
  border-radius: 10px; /* same as main form inputs */
  background: #fff;
  font-size: 1rem; /* consistent text size */
  line-height: 1.2;
  box-sizing: border-box;
}


/* For mobile screens */
@media (max-width: 600px) {
  .row.date-group {
    flex-wrap: wrap;
  }
  .date-group .date-label {
    width: 100%;
    margin-bottom: 4px;
  }
  .date-group .date-inputs {
    width: 100%;
  }
}

/* ---------- TIME GROUP USING LABEL (NO HTML CHANGE NEEDED) ---------- */

/* Make the label behave like .row.date-group */
label:has(.time-input-group) {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
}

/* Style the label text (the text before the div) */
label:has(.time-input-group) > :first-child {
  flex: 0 0 auto;
  white-space: nowrap;
  margin-right: 6px;
  font-weight: 500;
  color: #333;
}

/* Fix for label text (because :first-child matches text node) */
label:has(.time-input-group)::first-line {
  font-weight: 500;
}

/* Container for HH/MM/AMPM */
.time-input-group {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-grow: 0;
  flex-shrink: 0;
}

/* Match padding, border, height, radius of date inputs */
.time-input-group input,
.time-input-group select {
  width: 3.8em;
  text-align: center;
  padding: 9px 0;                /* SAME as date field */
  border: 1px solid #ddd;
  border-radius: 10px;           /* SAME rounded corners */
  background: #fff;
  font-size: 1rem;
  line-height: 1.2;
  box-sizing: border-box;
}

/* AMPM select wider slightly */
.time-input-group select {
  width: 4.8em;
}

/* Separator (:) alignment fix */
.time-input-group .separator {
  display: inline-block;
  margin: 0 2px;
}

/* Mobile style mirroring .date-group */
@media (max-width: 600px) {
  label:has(.time-input-group) {
    flex-wrap: wrap;
  }

  label:has(.time-input-group) > :first-child {
    width: 100%;
    margin-bottom: 4px;
  }

  .time-input-group {
    width: 100%;
  }
}

  /* Signature preview tiles */
  .sig-preview{
    width:100%; height:150px; border:1px dashed #bbb; border-radius:10px;
    display:flex; align-items:center; justify-content:center; background:#fff; cursor:pointer; position:relative;
  }
  .sig-preview img{ max-width:100%; max-height:100%; object-fit:contain; }
  .sig-preview span{ color:#999; }

  /* Signature Modal */
  .sig-modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:1000; }
  .sig-modal .box{
    width:min(560px, 92vw); background:#fff; margin:6vh auto; padding:14px; border-radius:12px;
    box-shadow:0 18px 50px rgba(0,0,0,.25)
  }
  .sig-modal h3{ margin:0 0 8px 0; }
  /* NOTE: canvas is responsive via CSS; internal pixels are set in JS for crispness */
  #sigCanvas{ width:100%; height:220px; background:#fff; border:1px solid #ddd; border-radius:10px; touch-action:none }
  .sig-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:10px; }

  /* Hidden signature XY tuning inputs (owner/witness) */
  .hidden-inputs {display: none;}

  /* Preview pane */
  .preview{background:#fff;border:1px solid #eee;border-radius:10px;padding:10px}
  .preview canvas{width:100%;height:auto;border-radius:8px}

  /* Save indicator */
  #saveStatus{
    position:fixed; top:12px; right:12px; background:var(--accent); color:#fff;
    padding:6px 10px; border-radius:8px; font-size:0.85rem; opacity:0; transition:opacity .25s;
  }

  @media (max-width:720px){
    .policy-grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<main>
  <h1>Medical & Accident Claim - Claimant's Statement (LF5191)</h1>

  <!-- SECTION: Policy Info -->
  <section class="section">
    <h2>1. Particulars of Policy</h2>

     <div class="row date-group"> 
  <label class="date-label">Date submitted
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
  
  <div class="date-inputs">
    <input id="ClmMed_Basicinfo_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Basicinfo_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Basicinfo_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

   <div class="grid-2">
       <label style="flex:1">Agent Name
        <input id="ClmMed_Basicinfo_Agent" class="persist" type="text" placeholder="Enter name">
      </label>
       <label style="flex:1">Agent Contact
        <input id="ClmMed_Basicinfo_Mobile" class="persist" type="text" placeholder="Enter contact">
      </label>
      <label style="flex:1">Agency Name
        <input id="CClmMed_Basicinfo_Agency" class="persist" type="text" placeholder="Enter name eg. DU Life Group Sdn Bhd">
      </label>
   </div>
     
  <div class="grid-2">
      <label style="flex:1">Policy(1)
        <input id="ClmMed_Basicinfo_PolicyNo1" class="persist" type="text" placeholder="Enter policy no.">
      </label>
      <label style="flex:1">Policy(2)
        <input id="CClmMed_Basicinfo_PolicyNo2" class="persist" type="text" placeholder="Enter policy no.">
      </label>
      <label style="flex:1">Policy(3)
        <input id="ClmMed_Basicinfo_PolicyNo3" class="persist" type="text" placeholder="Enter policy no.">
      </label>
      <label style="flex:1">Policy(4)
        <input id="CClmMed_Basicinfo_PolicyNo4" class="persist" type="text" placeholder="Enter policy no.">
      </label>
    </div>
  </section>


   <!-- SECTION: Type of Claim -->
  <section class="section">
    <h2>2. Type of Claim</h2>

    <section class="section">
   <div class="grid-2">
      <label style="flex:1"><input id="ClmMed_Claimtype_Hosp" class="persist" type="checkbox">Hospitalisation/Day Surgery Medical Expenses
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_PrePost" class="persist" type="checkbox">Pre or Post Hospitalisation Treatment
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_AccInjury" class="persist" type="checkbox">Outpatient Emergency Accidental Injury Treatment
      </label>
      <label style="flex:1"><input id="Complx_Insured_NIRC" class="persist" type="checkbox">Outpatient Kidney Dialysis/Outpatient Cancer Treatment
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_OpDengue" class="persist" type="checkbox">Outpatient Dengue Fever Treatment
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_Home" class="persist" type="checkbox">Home Nursing Care
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_HospBen" class="persist" type="checkbox">Hospitalization Benefit/Allowance only
      </label>
      <label style="flex:1"><input id="ClmMed_Claimtype_AccIndemnity" class="persist" type="checkbox">Accident Indemnity
      </label>
      <label style="flex:1"><input id="CoClmMed_Claimtype_Others" class="persist" type="checkbox">Others<input id="ClmMed_Claimtype_Others_Text" class="persist" type="text" placeholder="Please Specify">
      </label>
    </div>
    </section>
    
     <div class="row">
       <label style="flex:1">Total Claim Amount (Medical Expenses Only): (RM)
        <input id="ClmMed_Claimtype_Amt" class="persist" type="text" placeholder="Enter amount (only enter digits)">
      </label>
    </div>
    
  </section>

  <!-- SECTION 3: Particulars of Insured Person-->
  <section class="section">
    <h2>3: Particulars of Insured Person</h2>
 <div class="row">
  <small class="muted">Ensure your email and mobile number are updated in order to receive claim notifications on a timely manner.</small>
 </div>
    
     <div class="row">
      <label style="flex:1">Name<input id="ClmMed_Insuredinfo_Name" class="persist" type="text" placeholder="Enter name">
      </label>
    </div>
    <div class="row">
      <label style="flex:1">NIRC/Passport No.<input id="ClmMed_Insuredinfo_NIRC" class="persist" type="text" placeholder="Enter number">
      </label>
     </div>
    <div class="row">
      <label style="flex:1">Mobile No.<input id="ClmMed_Insuredinfo_Mobile" class="persist" type="text" placeholder="Enter mobile no.">
      </label>
         <label style="flex:1">Email<input id="ClmMed_Insuredinfo_Email" class="persist" type="text" placeholder="Enter email">
      </label>
     </div>
   <div class="row">
      <label style="flex:1">Current Correspondence Address<textarea id="ClmMed_Insuredinfo_Add" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
       <div class="row">
      <label style="flex:1">Current Occuption<input id="ClmMed_Insuredinfo_Occupat" class="persist" type="text" placeholder="Enter occupation">
      </label>
     </div>
       <div class="row">
      <label style="flex:1">Exaxt Duties Performed<input id="ClmMed_Insuredinfo_Duties" class="persist" type="text" placeholder="Enter number">
      </label>
     </div>
       <div class="row">
      <label style="flex:1">Name of Current Employer<input id="ClmMed_Insuredinfo_Employer" class="persist" type="text" placeholder="Enter number">
      </label>
     </div>
       <div class="row">
      <label style="flex:1">Address of Employer<textarea id="ClmMed_Insuredinfo_EmployerAdd" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
  </section>


  <!-- SECTION 4: Particulars of policyowner-->
  <section class="section">
    <h2>3: Particulars of Policyowner</h2>
    <div class="row">
      <label style="flex:1"><input id="CB_PO" class="persist" type="checkbox">Insured and Policyowner is DIFFERENT PERSON
      </label>
    </div>
    
    <section class="section" id="Policyownerinfo">
        <div class="row">
      <label style="flex:1">Name<input id="ClmMed_POinfo_Name" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>
    <div class="row">
      <label style="flex:1">NIRC/Passport No.<input id="ClmMed_POinfo_NIRC" class="persist" type="text" placeholder="Enter number">
      </label>
     </div>
    <div class="row">
      <label style="flex:1">Mobile No.<input id="ClmMed_POinfo_Mobile" class="persist" type="text" placeholder="Enter mobile no.">
      </label>
         <label style="flex:1">Email<input id="ClmMed_POinfo_Email" class="persist" type="text" placeholder="Enter email">
      </label>
     </div>
   <div class="row">
      <label style="flex:1">Current Correspondence Address<textarea id="ClmMed_POinfo_Add" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
    </section>
  </section>

  <!-- SECTION 5: Particular of Illness/Accident-->
  <section class="section">
    <h2>4. Particulars of Illness/Accident</h2>

     <div class="row">
      <label style="flex:1">Nature of Illness Disability<input id="ClmMed_Illness_Nature" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

         <div class="row date-group"> 
  <label class="date-label">Date of diagnosis
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
  
  <div class="date-inputs">
    <input id="ClmMed_Illness_Diagnosis_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Illness_Diagnosis_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Illness_Diagnosis_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

       <div class="row">
      <label style="flex:1">Presenting sign and symptoms<input id="ClmMed_Illness_Sympton" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

     <div class="row date-group"> 
  <label class="date-label">Onset date
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="ClmMed_Illness_Onset_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Illness_Onset_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="UClmMed_Illness_Onset_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

        <div class="row">
      <label style="flex:1"><input id="CB_PO" class="persist" type="checkbox">This is due to Accident
      </label>
    </div>

    <div id="accidentsection">
    <div class="row date-group"> 
  <label class="date-label">Date of accident
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="ClmMed_Accident_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

    <div>
<label>Time of accident
  <div class="time-input-group" data-field="ClmMed_Accident_Time">
    <input id="AppointmentTime_HH" class="persist time-input" placeholder="HH" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    
    <span class="separator">:</span>
    
    <input id="AppointmentTime_MM" class="persist time-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    
    <select id="AppointmentTime_AMPM" class="persist">
      <option value="">--</option>
      <option value="AM">AM</option>
      <option value="PM">PM</option>
    </select>
  </div>
</label>
      </div>

    <div class="row">
      <label style="flex:1">Place of accident<input id="ClmMed_Accident_Place" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

    <div class="row">
      <label style="flex:1">How did the accident happen?<textarea id="ClmMed_Accident_How" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>

    <div class="row">
      <label style="flex:1">Nature and extend of injury<textarea id="CClmMed_Accident_Injury" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>

    <div class="row date-group"> 
  <label class="date-label">Date first absent from work due to accident
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="ClmMed_Accident_AbsentDay" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_AbsentMonth" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_AbsentYear" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

    <div class="row date-group"> 
  <label class="date-label">Date returned to work
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="ClmMed_Accident_ReturnDay" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_ReturnMonth" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="ClmMed_Accident_ReturnYear" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

  </div>
  </section>

  <!-- SECTION 6: Particulars of Dr -->
  <section id="UserOption" class="section">
  <h2>6. Particulars of Doctors Consulted</h2>

   
    <section class="section">
      <div class="row">
      <label style="flex:1">First doctor consulted for this illness/disability</label>
      </div>
      
      <div class="row date-group" data-combine="true" data-field="ClmMed_Dr_First_Date"> 
  <label class="date-label">First consultation date
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

          <div class="row">
      <label style="flex:1">Name and Address of Doctor(s)<textarea id="ClmMed_Dr_First_NameAdd" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
      
    </section>

<section class="section">
      <div class="row">
      <label style="flex:1">All other doctors consulted for this illness/disability</label>
      </div>
      
      <div class="row date-group"> 
  <label class="date-label">First consultation date
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs" data-combine="true" data-field="ClmMed_Dr_Others_Date">
    <input class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

          <div class="row">
      <label style="flex:1">Name and Address of Doctor(s)<textarea id="ClmMed_Dr_Others_NameAdd" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
      
    </section>

    <section class="section">
      <div class="row">
      <label style="flex:1">Regular doctors/ gynaecologist/ obstetrician</label>
      </div>
      
      <div class="row date-group" data-combine="true" data-field="ClmMed_Dr_Regular_Date"> 
  <label class="date-label">First consultation date
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="UpdateOccupation_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="UpdateOccupation_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="UpdateOccupation_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

          <div class="row">
      <label style="flex:1">Name and Address of Doctor(s)<textarea id="ClmMed_Dr_Regular_NameAdd" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
      
    </section>

    <section class="section">
      <div class="row" data-combine="true" data-field="ClmMed_Dr_5yrs_Date">
      <label style="flex:1">All other doctors consulted in the past five (5) years</label>
      </div>
      
      <div class="row date-group"> 
  <label class="date-label">First consultation date
    <span class="muted">(DD/MM/YYYY)</span>
  </label>
    
      <div class="date-inputs">
    <input id="UpdateOccupation_Day" class="persist date-input" placeholder="DD" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="UpdateOccupation_Month" class="persist date-input" placeholder="MM" type="text" maxlength="2" inputmode="numeric" pattern="\d*">
    <input id="UpdateOccupation_Year" class="persist date-input" placeholder="YYYY" type="text" maxlength="4" inputmode="numeric" pattern="\d*">
  </div>
</div>

          <div class="row">
      <label style="flex:1">Name and Address of Doctor(s)<textarea id="ClmMed_Dr_5yrs_NameAdd" class="persist" placeholder="Enter address"></textarea>
      </label>
     </div>
    </section>
  </section>

    <!-- SECTION 8: E Banking -->
  <section id="UserOption" class="section">
  <h2>6. Particulars of Bank Account for Claim Payment</h2>

   <div class="row">
      <label style="flex:1">Account Holder Name<input id="ClmMed_EBank_Name" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

      <div class="row">
      <label style="flex:1">New IC/Old IC/Passport No/Co. Registration No.
(as per bankâ€™s records)<input id="ClmMed_EBank_NIRC" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

      <div class="row">
      <label style="flex:1">Bank Account No.<input id="ClmMed_EBank_AccNo" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

          <div class="row">
      <label style="flex:1">Name of Bank<input id="ClmMed_EBank_Bank" class="persist" type="text" placeholder="Enter name">
      </label>
     </div>

    <div class="row">
    <label>Bank Account Type</label>  
    <div>
        <label class="inline"><input id="ClmMed_EBank_Conventional" class="persist"  name="Accounttype" type="radio">Conventional</label>
      </div>
      <div>
        <label class="inline"><input id="ClmMed_EBank_Islamic" class="persist"  name="Accounttype" type="radio">Islamic</label>
      </div>
    </div>
  </section>
    
    
  <!-- SECTION: Signature Details (Date/Place) -->
  <section class="section">
    <h2>Signature Details</h2>
    <div class="row">
      <label style="flex:1">Signed at (State)
        <select id="Complx_Sign_State" class="persist">
          <option value="">-- Select State --</option>
          <!-- Same bel set used in your reference -->
          <option>SELANGOR</option><option>K.LUMPUR</option><option>MELAKA</option><option>JOHOR</option>
          <option>N.SEMBILAN</option><option>PENANG</option><option>PERAK</option><option>SABAH</option>
          <option>SARAWAK</option><option>KELANTAN</option><option>PERLIS</option><option>T'GANU</option>
          <option>PAHANG</option><option>KEDAH</option>
        </select>
      </label>
    </div>
    <div class="row">
      <label style="flex:1">Day
        <select id="Complx_Sign_Day" class="persist">
          <option value="">-- Day (DD) --</option>
          <option>01</option><option>02</option><option>03</option><option>04</option>
          <option>05</option><option>06</option><option>07</option><option>08</option>
          <option>09</option><option>10</option><option>11</option><option>12</option>
          <option>13</option><option>14</option><option>15</option><option>16</option>
          <option>17</option><option>18</option><option>19</option><option>20</option>
          <option>21</option><option>22</option><option>23</option><option>24</option>
          <option>25</option><option>26</option><option>27</option><option>28</option>
          <option>29</option><option>30</option><option>31</option>
        </select>
      </label>
      <label style="flex:1">Month
        <select id="Complx_Sign_Month" class="persist">
          <option value="">-- Month --</option>
          <option>JANUARY</option><option>FEBRUARY</option><option>MARCH</option><option>APRIL</option>
          <option>MAY</option><option>JUNE</option><option>JULY</option><option>AUGUST</option>
          <option>SEPTEMBER</option><option>OCTOBER</option><option>NOVEMBER</option><option>DECEMBER</option>
        </select>
      </label>
      <label style="flex:1">Year
        <select id="Complx_Sign_Year" class="persist">
          <option value="">-- Year (YYYY) --</option>
          <option>2025</option><option>2026</option>
        </select>
      </label>
    </div>
  </section>

  <!-- SECTION: Owner/Policyowner Signature -->
  <section class="section">
    <h2>Signature of Policy Owner/Assignee</h2>
    <div class="row">
      <label style="flex:1">Name of Policyowner/Assignee
        <input id="Complx_Sign_PO_Name" class="persist" type="text" placeholder="Enter name">
      </label>
    </div>
    <div class="row">
    <label style="flex:1">IC No.
        <input id="Complx_Sign_PO_NIRC" class="persist" type="text" placeholder="e.g. 900101-14-1234">
    </label>
    </div>

        <div class="sig-preview" id="preview_simple_owner" onclick="openSig('simple_owner')">
      <span>Tap to Sign (Policyowner / Assignee)</span>
    </div>
    <div class="row">
      <button id="clearPreview_Simple_Owner" class="secondary" type="button">Clear Signature</button>
    </div>
  </section>

  <!-- SECTION: Witness Signature -->
  <section class="section">
    <h2>Signature of Witness</h2>
    <div class="row">
      <label style="flex:1">Name of Witness
        <input id="Complx_Sign_Witness_Name" class="persist" type="text" placeholder="Enter name">
      </label>
    </div>
    <div class="row">
      <label style="flex:1">IC No.
        <input id="Complx_Sign_Witness_NIRC" class="persist" type="text" placeholder="e.g. 800202-08-5678">
      </label>
      <label style="flex:1">Mobile No.
        <input id="Complx_Sign_Witness_Mobile" class="persist" type="text" placeholder="e.g. 012-23456789">
      </label>
    </div>

    <div class="sig-preview" id="preview_simple_witness" onclick="openSig('simple_witness')">
      <span>Tap to Sign (Witness)</span>
    </div>
    <div class="row">
      <button id="clearPreview_Simple_Witness" class="secondary" type="button">Clear Signature</button>
    </div>
  </section>
  
    <!-- SECTION: Assignee -->
  <section class="section">
    <h2>Signature of Trustee(s)/Nominee(s)</h2>
    <div class="row">
      <label style="flex:1">Name of Trustee/Assignee
        <input id="Complx_Sign_Trustee_Name" class="persist" type="text" placeholder="Enter name">
      </label>
    </div>
    <div class="row">
    <label style="flex:1">IC No.
        <input id="Complx_Sign_Trustee_NIRC" class="persist" type="text" placeholder="e.g. 900101-14-1234">
    </label>
    </div>


    <div class="sig-preview" id="preview_simple_assignee" onclick="openSig('simple_assignee')">
      <span>Tap to Sign (Trustee/Nominee)</span>
    </div>
    <div class="row">
      <button id="clearPreview_Simple_Assignee" class="secondary" type="button">Clear Signature</button>
    </div>
  </section>
    
    <section class="section actions">
    <button id="generate">Generate PDF</button>
    <button id="resetAll" class="secondary">Reset All</button>
  </section>

  
    <div id="sigModal" class="sig-modal" aria-hidden="true">
  <div class="box">
    <h3 id="sigModalTitle">Draw Signature</h3>
    <!-- Responsive canvas: internal pixels are set in JS for crispness -->
    <canvas id="sigCanvas"></canvas>
    <div class="sig-actions">
      <button id="sigDone" type="button">Done</button>
      <button id="sigClear" type="button" class="ghost">Clear</button>
      <button id="sigCancel" type="button" class="secondary">Cancel</button>
    </div>
  </div>
</div>
    <div id="saveStatus">Saved</div>


  <button id="scrollTopBtn" onclick="scrollToTop()" aria-label="Back to top">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M8 4.354l-5.146 5.147.708.708L8 5.768l4.438 4.441.708-.708z"/>
  </svg>
</button>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script>

  function $(id) {
  return document.getElementById(id);
}
  
/* ---------- CONFIG ---------- */
const PDF_FILENAME = "Request-For-Change-of-Policy-Condition_LF5189_fillable.pdf";

// ---------- SECTION CONTROL CONFIG ----------
const CONTROLLER_BY_SECTION = {
  UpdateoccupationSection: "Updateoccupation",
  ReducepremiumSection: "Reducepremium",
  IncreaseFASection: "IncreaseFA",
  AddriderSection: "Addrider",
  ReviewmedratingSection: "Reviewmedrating",
  ReduceFASection: "ReduceFA",
  CancelriderSection: "Cancelrider",
  OtherschangeconditionSection: "Otherschangecondition",
};

// ---------- UI ENABLE/DISABLE TOGGLE ----------
document.addEventListener("DOMContentLoaded", () => {
  function setSectionEnabled(sectionEl, enabled) {
    if (!sectionEl) return;
    const inputs = sectionEl.querySelectorAll("input, select, textarea, button");
    inputs.forEach(el => el.disabled = !enabled);

    sectionEl.style.display = enabled ? "" : "none";
  }

  Object.entries(CONTROLLER_BY_SECTION).forEach(([sectionId, controllerId]) => {
    const controller = document.getElementById(controllerId);
    const section = document.getElementById(sectionId);
    if (controller && section) {
      const updateState = () => setSectionEnabled(section, controller.checked);
      controller.addEventListener("change", updateState);
      updateState(); // initialize state on load
    }
  });
});


window.addEventListener("DOMContentLoaded", () => {

  /* --- UNIVERSAL AUTO-TAB DATE LOGIC --- */
  const dateGroups = document.querySelectorAll('.date-group'); // group-level control

  dateGroups.forEach(group => {
    const inputs = group.querySelectorAll('.date-input');

    inputs.forEach((currentInput, index) => {
      const maxLength = parseInt(currentInput.getAttribute('maxlength'), 10);

      if (maxLength > 0) {
        currentInput.addEventListener('input', (e) => {
          // allow only numbers
          e.target.value = e.target.value.replace(/[^0-9]/g, '');

          // if full and not the last field in this group
          if (e.target.value.length === maxLength && index < inputs.length - 1) {
            const nextInput = inputs[index + 1];
            if (nextInput) {
              nextInput.focus();
              nextInput.select();
            }
          }
        });
      }
    });
  });

  /* --- END: Universal Auto-Tab Date Logic --- */
});


// ---------- EXPORT FILTER LOGIC ----------
function shouldIncludeFieldByUI(fieldId) {
  const el = document.getElementById(fieldId);
  if (!el) return true;
  let parent = el;
  while (parent && parent !== document.body) {
    if (parent.id && CONTROLLER_BY_SECTION[parent.id]) {
      const controllerId = CONTROLLER_BY_SECTION[parent.id];
      const cb = document.getElementById(controllerId);
      if (cb && !cb.checked) return false; // skip if unchecked
    }
    parent = parent.parentElement;
  }
  return true;
}


/* ---SAVE STATUS + LOCALSTORAGE (Text, Checkbox, Dropdown) ---------- */
const saveStatusEl = document.getElementById("saveStatus");

function showSaveStatus(){
  saveStatusEl.style.opacity = 1;
  clearTimeout(saveStatusEl._timer);
  saveStatusEl._timer = setTimeout(()=> saveStatusEl.style.opacity = 0, 1200);
}

function saveElValue(el){
  localStorage.setItem(el.id, el.value);
  showSaveStatus();
}

function autoBindSave(el) {
  const saved = localStorage.getItem(el.id);

  // Restore
  if (el.type === "checkbox") {
    if (saved !== null) el.checked = (saved === "true");
  } else if (el.type === "radio") {
    const savedRadioValue = localStorage.getItem(el.name);
    if (savedRadioValue) {
      el.checked = (el.id === savedRadioValue);
    }
  } else if (saved !== null) {
    el.value = saved;
  }

  // Bind save
  if (el.tagName === "SELECT") {
    el.addEventListener("change", () => saveElValue(el));
  } else if (el.type === "checkbox") {
    el.addEventListener("change", () => {
      localStorage.setItem(el.id, el.checked);
      showSaveStatus();
    });
  } else if (el.type === "radio") {
    el.addEventListener("change", () => {
      if (el.checked) {
        localStorage.setItem(el.name, el.id); // store under group name
        showSaveStatus();
      }
    });
} else {
  el.addEventListener("input", () => {
    if (el.id !== "MHSE_Info_POEmail") { //except Email
      el.value = el.value.toUpperCase();   // update textbox itself
    }
    localStorage.setItem(el.id, el.value);
    showSaveStatus();
  });
}
}

  
/* ---------- UNIVERSAL HELPER FUNCTION ---------- */

  //Detect input type - text/dropdown/checkbox/radio
function safeSetField(form, fieldName, value) {
  if (value === null || value === undefined) return;

  try {
    let field;

    // text or textarea, then force Uppercase
    try {
      field = form.getTextField(fieldName);
      // Keep original case for email
      if (fieldName === "MHSE_Info_POEmail") {
        field.setText(value);
      } else {
        field.setText(value.toUpperCase());
      }
      return;
    } catch (e) {}

    // dropdown
    try {
      field = form.getDropdown(fieldName);
      field.select(value);
      return;
    } catch (e) {}

    // checkbox
    try {
      field = form.getCheckBox(fieldName);
      if (value === true || value === "true" || value === "on" || value === "checked") {
        field.check();
      } else {
        field.uncheck();
      }
      return;
    } catch (e) {}
    
    // radio
    try {
      field = form.getRadioGroup(fieldName);
      field.select(value);
      return;
    } catch (e) {}

    console.warn(`Field ${fieldName} not found in PDF`);
  } catch (err) {
    console.error(`Error setting field ${fieldName}`, err);
  }
}

/* ---------- Date Input Helper : Combine into ONE string  ---------- */
document.addEventListener("DOMContentLoaded", () => {
  // Target only date groups that have data-combine="true"
  const combinedGroups = document.querySelectorAll('.date-group[data-combine="true"]');

  combinedGroups.forEach(group => {
    const fieldId = group.dataset.field; // e.g. ClmMed_Dr_First_Date
    const inputs = group.querySelectorAll(".date-input");

    // Restore saved combined date
    const saved = localStorage.getItem(fieldId);
    if (saved) {
      const [d, m, y] = saved.split("/");
      if (inputs[0]) inputs[0].value = d || "";
      if (inputs[1]) inputs[1].value = m || "";
      if (inputs[2]) inputs[2].value = y || "";
    }

    // Save combined value on any input change
    inputs.forEach(input => {
      input.addEventListener("input", () => {
        const [d, m, y] = Array.from(inputs).map(i => i.value.trim());
        const combined = [d, m, y].filter(Boolean).join("/");
        localStorage.setItem(fieldId, combined);
      });
    });
  });
});

/* ---------- Time Input Helper : Combine into ONE string  ---------- */
document.addEventListener("DOMContentLoaded", () => {
  const timeGroups = document.querySelectorAll(".time-group[data-field]");

  timeGroups.forEach(group => {
    const fieldId = group.dataset.field; // e.g. ClmMed_Accident_Time
    const hourInput = group.querySelector('input[placeholder="HH"]');
    const minuteInput = group.querySelector('input[placeholder="MM"]');
    const ampmSelect = group.querySelector("select");

    // --- Restore saved time ---
    const saved = localStorage.getItem(fieldId);
    if (saved) {
      // Expect "HH:MM AM" or "HH:MM PM"
      const [time, period] = saved.split(" ");
      if (time) {
        const [hh, mm] = time.split(":");
        if (hourInput) hourInput.value = hh || "";
        if (minuteInput) minuteInput.value = mm || "";
      }
      if (ampmSelect) ampmSelect.value = period || "";
    }

    // --- Save combined time on change ---
    const saveTime = () => {
      const hh = hourInput.value.trim().padStart(2, "0");
      const mm = minuteInput.value.trim().padStart(2, "0");
      const ampm = ampmSelect.value;
      const combined = (hh || mm || ampm) ? `${hh}:${mm} ${ampm}`.trim() : "";
      localStorage.setItem(fieldId, combined);
    };

    [hourInput, minuteInput, ampmSelect].forEach(el => {
      el.addEventListener("input", saveTime);
      el.addEventListener("change", saveTime);
    });
  });
});


/* ---------- SIGNATURE MODAL LOGIC (Owner + Payor) with HiDPI scaling ---------- */
let sigTarget = null;
const sigModal = $("sigModal");
const sigCanvas = $("sigCanvas");
const sigCtx = sigCanvas.getContext("2d");
let drawing = false;
let scaleX = 1, scaleY = 1;

/* Resize canvas to look crisp on any screen size & DPR */
function resizeSigCanvas(){
  const dpr = window.devicePixelRatio || 1;
  const cssWidth = sigCanvas.clientWidth || sigCanvas.parentElement.clientWidth || 560;
  const cssHeight = sigCanvas.clientHeight || 220;
  sigCanvas.width = Math.max(1, Math.floor(cssWidth * dpr));
  sigCanvas.height = Math.max(1, Math.floor(cssHeight * dpr));
  sigCtx.setTransform(1,0,0,1,0,0); // reset
  sigCtx.scale(dpr, dpr);
  sigCtx.lineWidth = 2;
  sigCtx.lineCap = "round";
  sigCtx.strokeStyle = "#000";
  scaleX = sigCanvas.width / (sigCanvas.getBoundingClientRect().width || cssWidth);
  scaleY = sigCanvas.height / (sigCanvas.getBoundingClientRect().height || cssHeight);
  // White background (prevents transparent PNG on PDFs)
  //sigCtx.fillStyle = "#fff";
  //sigCtx.fillRect(0,0,sigCanvas.width/scaleX, sigCanvas.height/scaleY);
}

function openSig(target){
  sigTarget = target; // 'simple_owner' | 'simple_witness' | 'simple_assignee' | 'simple_oldsig'| 'simple_newsig'

if (target === 'simple_owner') {
  $("sigModalTitle").textContent = "Sign: Policy Owner";
} else if (target === 'simple_witness') {
  $("sigModalTitle").textContent = "Sign: Witness";
} else if (target === 'simple_assignee') {
  $("sigModalTitle").textContent = "Sign: Trustee";
}

  sigModal.style.display = "block";
  sigModal.setAttribute("aria-hidden", "false");

  // Next frame: ensure layout settled then resize canvas
  requestAnimationFrame(()=>{
    resizeSigCanvas();
  sigCtx.clearRect(0, 0, sigCanvas.width, sigCanvas.height);
  
    // If there is an existing signature, draw it to current canvas size
    const existing = localStorage.getItem("sig_"+target);
    if (existing){
      const img = new Image();
      img.onload = ()=>{
        // cover the canvas area with existing image
        sigCtx.drawImage(img, 0, 0, sigCanvas.width/scaleX, sigCanvas.height/scaleY);
      };
      img.src = existing;
    }
  });
}
$("sigClear").addEventListener("click", ()=>{
  sigCtx.clearRect(0,0,sigCanvas.width, sigCanvas.height);
  // Repaint white bg in CSS pixels
  //sigCtx.fillStyle="#fff"; sigCtx.fillRect(0,0,sigCanvas.width/scaleX, sigCanvas.height/scaleY);
});
$("sigCancel").addEventListener("click", closeSigModal);
function closeSigModal(){
  sigModal.style.display = "none";
  sigModal.setAttribute("aria-hidden", "true");
  sigTarget = null;
}
$("sigDone").addEventListener("click", ()=>{
  if(!sigTarget) return;
  const dataURL = sigCanvas.toDataURL("image/png");
  localStorage.setItem("sig_"+sigTarget, dataURL);
  const preview = $("preview_"+sigTarget);
  preview.innerHTML = `<img alt="Signature ${sigTarget}" src="${dataURL}">`;
  closeSigModal();
});

/* Drawing (mouse + touch) with coordinate conversion */
function getPos(e){
  const rect = sigCanvas.getBoundingClientRect();
  if(e.touches && e.touches[0]){
    return { x: (e.touches[0].clientX - rect.left), y: (e.touches[0].clientY - rect.top) };
  }
  return { x: (e.clientX - rect.left), y: (e.clientY - rect.top) };
}
function startDraw(e){
  drawing = true;
  sigCtx.beginPath();
  const {x,y}=getPos(e);
  sigCtx.moveTo(x, y);
  e.preventDefault?.();
}
function endDraw(){ drawing = false; sigCtx.beginPath(); }
function moveDraw(e){
  if(!drawing) return;
  const {x,y} = getPos(e);
  sigCtx.lineTo(x, y);
  sigCtx.stroke();
  sigCtx.beginPath();
  sigCtx.moveTo(x, y);
  e.preventDefault?.();
}
sigCanvas.addEventListener("mousedown", startDraw);
sigCanvas.addEventListener("mousemove", moveDraw);
window.addEventListener("mouseup", endDraw);
sigCanvas.addEventListener("touchstart", startDraw, {passive:false});
sigCanvas.addEventListener("touchmove", moveDraw, {passive:false});
sigCanvas.addEventListener("touchend", endDraw);
window.addEventListener("resize", ()=> {
  // Only resize when modal is open to avoid reflow glitches
  if(sigModal.getAttribute("aria-hidden")==="false"){ 
    const img = new Image();
    img.onload = ()=>{
      resizeSigCanvas();
      sigCtx.drawImage(img, 0, 0, sigCanvas.width/scaleX, sigCanvas.height/scaleY);
    };
    img.src = sigCanvas.toDataURL("image/png");
  }
});

/* Clear preview buttons + Restore previews on load */
$("clearPreview_Simple_Owner").addEventListener("click", ()=>{
  localStorage.removeItem("sig_simple_owner");
  $("preview_simple_owner").innerHTML = `<span>Tap to Sign (Policyowner/Assignee)</span>`;
});
$("clearPreview_Simple_Witness").addEventListener("click", ()=>{
  localStorage.removeItem("sig_simple_witness");
  $("preview_simple_witness").innerHTML = `<span>Tap to Sign (Witness)</span>`;
});
$("clearPreview_Simple_Assignee").addEventListener("click", ()=>{
  localStorage.removeItem("sig_simple_assignee");
  $("preview_simple_assignee").innerHTML = `<span>Tap to Sign (Trustee/Nominee)</span>`;
});

window.addEventListener("DOMContentLoaded", ()=>{
  ["owner","witness","assignee"].forEach(role=>{
    const saved = localStorage.getItem("sig_simple_"+role);
    if(saved){ $("preview_simple_"+role).innerHTML = `<img alt="Signature ${role}" src="${saved}">`; }
  });
});
  

/* ---------- GENERATE PDF ---------- */
async function fillPDF(){
  try {
    $("generate").disabled = true;

    const res = await fetch(PDF_FILENAME);
    if (!res.ok) throw new Error("Cannot load PDF: " + PDF_FILENAME);
    const bytes = await res.arrayBuffer();
    const pdfDoc = await PDFLib.PDFDocument.load(bytes);
    const form = pdfDoc.getForm();

    const pages = pdfDoc.getPages();
    const page = pages[2]; // use 2nd page


    // FILL FORM FIELDS FROM LOCALSTORAGE HERE
const fieldNames = [
  "Complx_Insured_Name",
  "Complx_PolicyNo",
  "Complx_Insured_NIRC",
  "Complx_Occupation_New",
  "Complx_Occupation_Comp",
  "Complx_Occupation_Duty",
  "Complx_Occupation_MM",
  "Complx_Occupation_YYYY",
  "Complx_Occupation_Nature",
  "Complx_ReducePremium_Basic_Yes",
  "Complx_ReducePremium_Basic_Amt",
  "Complx_ReducePremium_Topup_Yes",
  "Complx_ReducePremium_Topup_Amt",
  "Complx_IncreaseFA_Basic",
  "Complx_IncreaseFA_Basic_Yes",
  "Complx_IncreaseFA_Rider_Yes",
  "Complx_IncreaseFA_Rider1_Name",
  "Complx_IncreaseFA_Rider1_FA",
  "Complx_IncreaseFA_Rider2_Name",
  "Complx_IncreaseFA_Rider3_Name",
  "Complx_IncreaseFA_Rider2_FA", 
  "Complx_IncreaseFA_Rider3_FA", 
  "Complx_AddRider_Yes",
  "Complx_AddRider1_Name",
  "Complx_AddRider1_Term",
  "Complx_AddRider1_FA",
  "Complx_AddRider2_Name",
  "Complx_AddRider3_Name",
  "Complx_AddRider2_Term",
  "Complx_AddRider3_Term",
  "Complx_AddRider2_FA",
  "Complx_AddRider3_FA",
  "Complx_Review_Rating",
  "Complx_Review_Exclusion",
  "Complx_ReduceFA_Basic_Yes",
  "Complx_ReduceFA_Basic_Amt",
  "Complx_ReduceFA_Rider_Yes",
  "Complx_ReduceFA_Rider1_Name2",
  "Complx_ReduceFA_Rider1_Name3",
  "Complx_ReduceFA_Rider1_FA1",
  "Complx_ReduceFA_Rider1_FA2",
  "Complx_ReduceFA_Rider1_FA3",
  "Complx_CancelRider_Yes",
  "Complx_ReduceFA_Rider_Name1",
  "Complx_CancelRider_Name1",
  "Complx_CancelRider_Name2",
  "Complx_CancelRider_Name3",
  "Complx_CancelRider_Name4",
  "Complx_CancelRider_Name5",
  "Complx_CancelRider_Name6",
  "Complx_Others_Line1",
  "Complx_Others_Line2",
  "Complx_Others_Line3",
  "Complx_Others_Line4",
  "Complx_Sign_State",
  "Complx_Sign_Day",
  "Complx_Sign_Month",
  "Complx_Sign_Year",
  "Complx_Sign_PO_Name",
  "Complx_Sign_PO_NIRC",
  "Complx_Sign_Trustee_Name",
  "Complx_Sign_Trustee_NIRC",
  "Complx_Sign_Witness_Name",
  "Complx_Sign_Witness_NIRC",
  "Complx_Sign_Witness_Mobile"
];

fieldNames.forEach(fieldName => {
  // If the UI section containing this field is currently unticked, skip it.
  if (!shouldIncludeFieldByUI(fieldName)) return;

  const value = localStorage.getItem(fieldName);
  safeSetField(form, fieldName, value);
});
    
    /* --------- SIGNATURE IMAGE EMBEDDING (embedPng + drawImage) --------- */

// Owner signature FillPDF
const sig_Simple_Owner = localStorage.getItem("sig_simple_owner");
if (sig_Simple_Owner) {
  try {
    const img_Simple_Owner = await pdfDoc.embedPng(sig_Simple_Owner);
    const { width, height } = img_Simple_Owner.size();

    const previewEl = document.getElementById("preview_simple_owner");
    const boxW = previewEl.offsetWidth;
    const boxH = previewEl.offsetHeight;

    const scale = Math.min(boxW / width, boxH / height);
    let drawW = width * scale;
    let drawH = height * scale;

    const factor = 0.40;    // % scale
    const posX = 50;         // X position on PDF
    const posY = 620;        // Y position on PDF

    drawW *= factor;
    drawH *= factor;

    page.drawImage(img_Simple_Owner, {
      x: posX,
      y: posY,
      width: drawW,
      height: drawH
    });
  } catch (e) {
    console.error(e);
  }
}

// Witness signature FillPDF
const sig_Simple_Witness = localStorage.getItem("sig_simple_witness");
if (sig_Simple_Witness) {
  try {
    const img_Simple_Witness = await pdfDoc.embedPng(sig_Simple_Witness);
    const { width, height } = img_Simple_Witness.size();

    const previewEl = document.getElementById("preview_simple_witness");
    const boxW = previewEl.offsetWidth;
    const boxH = previewEl.offsetHeight;

    const scale = Math.min(boxW / width, boxH / height);
    let drawW = width * scale;
    let drawH = height * scale;

    const factor = 0.40;    // % scale
    const posX = 410;         // X position on PDF
    const posY = 620;        // Y position on PDF

    drawW *= factor;
    drawH *= factor;

    page.drawImage(img_Simple_Witness, {
      x: posX,
      y: posY,
      width: drawW,
      height: drawH
    });
  } catch (e) {
    console.error(e);
  }
}


// Assignee signature FillPDF
const sig_Simple_Assignee = localStorage.getItem("sig_simple_assignee");
if (sig_Simple_Assignee) {
  try {
    const img_Simple_Assignee = await pdfDoc.embedPng(sig_Simple_Assignee);
    const { width, height } = img_Simple_Assignee.size();

    const previewEl = document.getElementById("preview_simple_assignee");
    const boxW = previewEl.offsetWidth;
    const boxH = previewEl.offsetHeight;

    const scale = Math.min(boxW / width, boxH / height);
    let drawW = width * scale;
    let drawH = height * scale;

    const factor = 0.40;    // % scale
    const posX = 230;         // X position on PDF
    const posY = 620;        // Y position on PDF

    drawW *= factor;
    drawH *= factor;

    page.drawImage(img_Simple_Assignee, {
      x: posX,
      y: posY,
      width: drawW,
      height: drawH
    });
  } catch (e) {
    console.error(e);
  }
}
    
    // Flatten form fields before saving
    form.flatten();
    
    // Save & download FillPDF
    const pdfBytes = await pdfDoc.save();
    const blob = new Blob([pdfBytes], { type: "application/pdf" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "Filled_RFC_Policy_Condition.pdf"; document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=> URL.revokeObjectURL(url), 2500);

  } catch(err){
    alert("PDF generation failed: " + (err.message || err));
    console.error(err);
  } finally {
    $("generate").disabled = false;
  }
}


/* ---------- RESET ALL DATA function ---------- */
function resetAll() {
  if (!confirm("Are you sure you want to reset the form? All saved data will be cleared.")) {
    return;
  }

  // 1) Clear ALL saved keys
  localStorage.clear();

  // 2) Clear the live UI values (inputs, checkboxes, radios, selects, textareas)
  document.querySelectorAll("input, select, textarea").forEach(el => {
    if (!el.id) return;
    if (el.type === "checkbox" || el.type === "radio") {
      el.checked = false;
    } else {
      el.value = "";
    }
  });

  // 3) Reset signature previews
  $("preview_simple_owner").innerHTML   = `<span>Tap to Sign (Policyowner/Assignee)</span>`;
  $("preview_simple_witness").innerHTML = `<span>Tap to Sign (Witness)</span>`;
  $("preview_simple_assignee").innerHTML = `<span>Tap to Sign (Trustee/Nominee)</span>`;


  // 4) Update status text if you have it
  showSaveStatus();
}

  /* ---------- Wire buttons ---------- */
$("generate").addEventListener("click", fillPDF);
$("resetAll").addEventListener("click", resetAll);
document.querySelectorAll(".persist").forEach(autoBindSave);


  // Show button when user scrolls down
window.addEventListener("scroll", () => {
  const btn = document.getElementById("scrollTopBtn");
  if (document.documentElement.scrollTop > 200 || document.body.scrollTop > 200) {
    btn.classList.add("show");
  } else {
    btn.classList.remove("show");
  }
});

// Smooth scroll to top
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: "smooth" });
}
  
</script>
</main> 
</body>
</html>
